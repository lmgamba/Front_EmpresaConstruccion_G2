<div class="dashboard-container">
  <main class="main-content">
    <header class="topbar">
      <h1>Worker Dashboard</h1>
      <div class="topbar-actions">
        <div class="profile">
          <div class="avatar">{{ currentUser()?.name?.[0] }}{{ currentUser()?.surname?.[0] }}</div>
        </div>
      </div>
    </header>

    <section class="metrics">
      @for (metric of metrics(); track metric.title) {
        <div class="metric-card">
          <div class="metric-title">{{ metric.title }}</div>
          <div class="metric-value">{{ metric.value }}</div>
          <div class="metric-sub">{{ metric.subtext }}</div>
        </div>
      }
    </section>

    <section class="content-grid">
      <div class="content-center">
        <div class="card map-card">
          <div class="card-header">
            <h3>My Current Assignment Location</h3>
          </div>

          <div class="map-placeholder p-0" style="overflow: hidden; min-height: 250px">
            @if (currentMapUrl()) {
              <iframe
                width="100%"
                height="100%"
                style="border: 0; min-height: 250px"
                loading="lazy"
                allowfullscreen
                [src]="currentMapUrl()"
              >
              </iframe>
              @if (myAssignments().length > 0) {
                <div class="map-overlay small">
                  <p>{{ myAssignments()[0].constructionName }}</p>
                </div>
              }
            } @else {
              <div
                class="d-flex flex-column align-items-center justify-content-center h-100 text-secondary"
              >
                <i class="bi bi-map-fill fs-1"></i>
                <span>No map data available for this site</span>
              </div>
            }
          </div>
        </div>

        <div class="card projects-card">
          <div class="card-header">
            <h3>My Active Assignments</h3>
          </div>
          <div class="assignments-list-scroll p-3">
            <div class="row g-3">
              @for (item of myAssignments(); track item.id_assignments) {
                <div class="col-12 col-xl-6">
                  <app-user-assignment-card
                    [assignment]="item"
                    [ArrayConstructions]="allConstructions()"
                  >
                  </app-user-assignment-card>
                </div>
              } @empty {
                <div class="text-center p-4">No assignments found.</div>
              }
            </div>
          </div>
        </div>
      </div>

      <div class="content-side">
        <div class="card workers">
          <div class="card-header">
            <h3>My Recent Reports</h3>
          </div>
          <div class="logs-minimal-list p-2">
            @for (log of recentLogs(); track log.id_logs) {
              <app-log-card class="log-item" [log]="log"></app-log-card>
            } @empty {
              <p class="text-center text-secondary">No reports submitted yet.</p>
            }
          </div>
        </div>

        <div class="card feed-card">
          <div class="card-header">
            <h3>Quick Actions</h3>
          </div>
          <div class="p-3 d-grid gap-2">
            <button class="btn btn-outline-info" routerLink="/dashboard_user/logs">
              <i class="bi bi-plus-circle"></i> Create New Report
            </button>
            <button class="btn btn-outline-light" routerLink="/dashboard-user/settings">
              <i class="bi bi-person-gear"></i> Profile Settings
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
